(window.webpackJsonp=window.webpackJsonp||[]).push([[9],{626:function(e,t,r){var content=r(698);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,r(19).default)("d78c3e46",content,!0,{sourceMap:!1})},693:function(e,t,r){e.exports=r.p+"img/otp.4a27452.png"},697:function(e,t,r){"use strict";r(626)},698:function(e,t,r){var o=r(18)((function(i){return i[1]}));o.push([e.i,'.normal-text[data-v-10a92a2b]{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Open Sans","Helvetica Neue",sans-serif}.sub-txt[data-v-10a92a2b]{color:#656d76}.sub-title[data-v-10a92a2b],.sub-txt[data-v-10a92a2b]{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Open Sans","Helvetica Neue",sans-serif;font-size:14px;line-height:150%;margin-bottom:14px;word-break:break-word}.sub-title[data-v-10a92a2b]{color:#000;font-weight:500}[data-v-10a92a2b] .el-dialog{width:-moz-fit-content;width:fit-content}[data-v-10a92a2b] .el-step .el-step__line{top:16px}[data-v-10a92a2b] .el-step .el-step__icon.is-text{border:2px solid #c0c4cc;height:32px;width:32px}[data-v-10a92a2b] .el-step .is-wait{color:#656d76}[data-v-10a92a2b] .el-step .is-process{color:#fff}[data-v-10a92a2b] .el-step .is-process .el-step__icon.is-text{background-color:#0969da;border:2px solid #0969da;height:32px;width:32px}[data-v-10a92a2b] .el-step .is-finish{border:#c0c4cc;color:#fff}[data-v-10a92a2b] .el-step .is-finish .el-step__icon.is-text{background-color:#0969da;border:2px solid #0969da;height:32px;width:32px}',""]),o.locals={},e.exports=o},715:function(e,t,r){"use strict";r.r(t);r(524),r(46),r(55),r(86),r(47),r(87);var o=r(16),n=r(2),l=(r(54),r(27),r(59),r(694),r(208),r(41),r(65),r(66),r(56),r(12),r(39),r(40),r(696));function c(object,e){var t=Object.keys(object);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(object);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(object,e).enumerable}))),t.push.apply(t,r)}return t}function d(e){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?c(Object(source),!0).forEach((function(t){Object(o.a)(e,t,source[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(source)):c(Object(source)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(source,t))}))}return e}var m=null,f={props:{username:String,forgetOtp:{type:Boolean,default:!1}},data:function(){var e=this;return{inputDisabled:!1,seedKey:"",OTPCode:"",captchaImgSrc:"",androidUrl:"https://play.google.com/store/apps/details?id=com.google.android.apps.authenticator2",appleUrl:"https://apps.apple.com/app/google-authenticator/id388497605",vivoUrl:"https://h5coml.vivo.com.cn/h5coml/appdetail_h5/browser_v2/index.html?appId=702082",VUE_APP_CAPTCHA:"1",VUE_APP_PUBKEY:"MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAkkApKkKERcT8C9pkcH7F2YxOyK8veLXqLm06iY+XlTuvSFCxC3Fe7AudJ01nj8BAXiI947/OTEHsbX8hQUIitJl1A/AFYiiqzd+ZzsQNPDrtXUMIGMFDa2KpYzSOCwLimZ4NHShXpynEjyer5jz55iL8LjwqBiPcHeg7IfA1Itfm4moONjaCBzMCtNw+5En6i4cS0f2Tilxh+8LLnryqThJiom64Yvu9NtLJLAYr5eGxQ6ng679AaD0nckXGOiy4HqgNA3LTGfq45L4wrCbLR2UcqPba9HJ90zamXz7elrgwFy1ShLCyLQ9+SjxGKKQpdxeqLvpttX+UY/+O4S8j2wIDAQAB",keyPair:null,step:-1,loading:!1,form:{username:"",password:"",captcha:""},emailForm:{emailToken:""},emailRules:{emailToken:[{required:!0,message:this.$t("login.validate_email_token_required")}]},rules:{username:[{required:!0,trigger:"manual",validator:function(t,r,o){r?r.length<1?o(new Error(e.$t("login.validate_username_less5_tip"))):o():o(new Error(e.$t("login.validate_username_required_tip")))}}],password:[{required:!0,trigger:"manual",validator:function(t,r,o){r?r.length<6||r.length>18?o(new Error(e.$t("login.validate_password6_tip"))):o():o(new Error(e.$t("login.validate_password6_tip")))}}],captcha:[{required:!0,trigger:"manual",validator:function(t,r,o){r?o():o(new Error(e.$t("login.validate_code_required")))}}]},errorMessage:"",qrcodeValue:""}},components:{QrcodeVue:l.a},computed:{validateEmailCode:function(){return!(this.emailForm.emailToken.length>5&&this.emailForm.emailToken.length<9)},validateOTPCode:function(){return!(6===this.OTPCode.length)}},methods:{showSecretKey:function(){this.$alert(this.seedKey,this.$t("login.otp.your_2fa_secret"),{confirmButtonText:this.$t("common.confirm")})},emailCodeHandleInput:function(e){var t=e.replace(/[^\d]+/g,"");this.emailForm.emailToken=t},OTPCodeHandleInput:function(e){var t=e.replace(/[^\d]+/g,"");this.OTPCode=t,6===this.OTPCode.length&&this.handleConfirmKey()},handleOpen:function(){this.form.username=this.username;var e=new m;this.keyPair=e.getKey(),this.forgetOtp&&(this.step=0,this.getCaptcha())},sendEmailCode:function(){var e=this;this.errorMessage="",this.$refs.form.validate(function(){var t=Object(n.a)(regeneratorRuntime.mark((function t(r){var o,i,n,l,c,m;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!r){t.next=26;break}for(e.loading=!0,t.prev=2,o="",i=0;i<6;i++)o+=Math.floor(10*Math.random());return t.next=7,e.$store.dispatch("getTimeStamp");case 7:return n=t.sent,l=n.timestamp,c=JSON.stringify({random:o,timestamp:l,password:e.form.password}),m=e.encryptPassword(c),null,t.next=14,e.$store.dispatch("sendEmailCode",d(d({},e.form),{},{password:m}));case 14:""===t.sent&&(e.$refs.form.clearValidate(),e.step=1),t.next=23;break;case 18:t.prev=18,t.t0=t.catch(2),e.getCaptcha(),e.errorMessage=t.t0.message,"9960"===t.t0.code&&(e.errorMessage="Email verification code has been sent, please try again in one minute");case 23:return t.prev=23,e.loading=!1,t.finish(23);case 26:case"end":return t.stop()}}),t,null,[[2,18,23,26]])})));return function(e){return t.apply(this,arguments)}}())},handleEnable2FA:function(){this.step=0,this.getCaptcha()},handleGetKey:function(){var e=this;this.$refs.emailForm.validate(function(){var t=Object(n.a)(regeneratorRuntime.mark((function t(r){var o,n,l,label,c,d,f,h;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!r){t.next=18;break}return e.loading=!0,t.prev=2,String.prototype.replaceAll=function(e,t){return this.replace(new RegExp("oldString","gm"),"newString")},t.next=6,e.$store.dispatch("getOTPKey",{otpSolution:"google",emailToken:e.emailForm.emailToken,publicKey:e.keyPair.getPublicKey().replace("-----BEGIN PUBLIC KEY-----","").replace("-----END PUBLIC KEY-----","").replace(/\n/g,""),username:e.form.username});case 6:o=t.sent,(n=new m).setPrivateKey(e.keyPair.getPrivateKey()),o.seedKey?(l=n.decrypt(o.seedKey),"TOMS",e.seedKey=l,label="",-1===e.form.username.indexOf("@")?(c=e.form.username.slice(0,3),d=e.form.username.slice(-1),label=c+"****"+d):(f=e.form.username.split("@"),h=f[0].slice(0,3),label=h+"****@"+f[1]),e.qrcodeValue="otpauth://totp/".concat(label,"?secret=").concat(l,"&issuer=").concat("TOMS"),window.onbeforeunload=function(){return""},e.$refs.emailForm.clearValidate(),e.step=2):e.errorMessage="Get 2FA failed, please reset One-Time Password(OTP)",t.next=15;break;case 12:t.prev=12,t.t0=t.catch(2),e.errorMessage=t.t0.message;case 15:return t.prev=15,e.loading=!1,t.finish(15);case 18:case"end":return t.stop()}}),t,null,[[2,12,15,18]])})));return function(e){return t.apply(this,arguments)}}())},handleConfirmKey:function(){var e=this;this.inputDisabled=!0,this.$store.dispatch("confirmOTPKey",{username:this.form.username,token:this.OTPCode}).then((function(t){e.$message({message:e.$t("login.otp.congratulations"),type:"success"}),window.onbeforeunload=function(){},e.step=-1,e.form={username:"",password:"",captcha:""},e.OTPCode="",e.emailForm.emailToken="",e.$refs.form&&e.$refs.form.clearValidate(),e.$refs.emailForm&&e.$refs.emailForm.clearValidate(),e.inputDisabled=!1,e.errorMessage="",e.$emit("set-otpcode",!0),e.$emit("update:visible",!1)})).catch((function(t){e.inputDisabled=!1,e.errorMessage=t.message}))},close:function(){this.$emit("set-otpcode",!1)},handleClose:function(e){var t=this;2===this.step?this.$confirm(this.$t("login.confirm_close_2fa_dialog"),this.$t("common.tip"),{confirmButtonText:this.$t("common.confirm"),cancelButtonText:this.$t("common.cancel"),type:"warning"}).then((function(){window.onbeforeunload=function(){},t.step=-1,t.form={username:"",password:"",captcha:""},t.OTPCode="",t.inputDisabled=!1,t.loading=!1,t.emailForm.emailToken="",t.$refs.form&&t.$refs.form.clearValidate(),t.$refs.emailForm&&t.$refs.emailForm.clearValidate(),t.errorMessage="",t.$emit("set-otpcode",!1),e()})).catch((function(){})):(this.step=-1,this.form={username:"",password:"",captcha:""},this.emailForm.emailToken="",this.$refs.form&&this.$refs.form.clearValidate(),this.$refs.emailForm&&this.$refs.emailForm.clearValidate(),this.inputDisabled=!1,this.loading=!1,this.OTPCode="",this.errorMessage="",this.$emit("set-otpcode",!1),this.$emit("update:visible",!1))},encryptPassword:function(e){var t=new m,r=this.VUE_APP_PUBKEY;return t.setPublicKey(r),t.encrypt(e)},getCaptcha:function(){if("1"==this.VUE_APP_CAPTCHA){this.captchaImgSrc="/online/authorization/auth/2FA/otp/captcha?time="+(new Date).getTime()+"&username="+this.form.username;var e=this,t=new XMLHttpRequest;t.responseType="blob",t.open("get",this.captchaImgSrc,!0),t.onreadystatechange=function(r){if(t.readyState==XMLHttpRequest.DONE&&200==t.status){var o=new FileReader;o.readAsText(t.response),o.onload=function(t){var r=o.result,n=JSON.parse(r);e.$nextTick((function(){e.$refs.img.src=n.captcha}))}}},t.send(null)}}},mounted:function(){return Object(n.a)(regeneratorRuntime.mark((function e(){var t,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.e(0).then(r.bind(null,712));case 2:t=e.sent,o=t.default,m=o;case 5:case"end":return e.stop()}}),e)})))()}},h=f,v=(r(697),r(10)),component=Object(v.a)(h,(function(){var e=this,t=e._self._c;return t("el-dialog",e._g(e._b({attrs:{top:"10vh","close-on-click-modal":!1,"before-close":e.handleClose},on:{open:e.handleOpen,close:e.close}},"el-dialog",e.$attrs,!1),e.$listeners),[-1===e.step?t("div",{staticStyle:{color:"#1f2328","word-break":"break-word","max-width":"500px"}},[t("div",{staticStyle:{"text-align":"center"}},[t("img",{attrs:{src:r(149),width:"150px",alt:""}}),e._v(" "),t("div",{staticStyle:{"font-size":"24px","line-height":"150%","margin-top":"32px"},domProps:{innerHTML:e._s(e.$t("login.otp_info"))}})]),e._v(" "),t("div",{staticStyle:{"margin-top":"28px","font-size":"14px","line-height":"150%",padding:"28px 28px",border:"solid 1px #DADEE1","background-color":"#F7F8FA","border-radius":"6px"}},[t("div",{staticStyle:{"text-align":"center"}},[t("p",{staticStyle:{"font-size":"24px","line-height":"150%","font-weight":"600"}},[e._v(e._s(e.username))])]),e._v(" "),t("div",{staticStyle:{"margin-top":"28px",display:"flex",padding:"14px",border:"solid 1px #B9D7F2","background-color":"#E1F3FF","border-radius":"6px"}},[t("i",{staticClass:"el-icon-warning-outline",staticStyle:{"font-size":"21px","margin-right":"7px","font-weight":"600",color:"#3E74C2"}}),e._v(" "),t("div",[t("div",[t("b",[e._v("\n              "+e._s(e.$t("login.otp.take_1m"))+"\n            ")])]),e._v(" "),t("div",{staticClass:"normal-text"},[e._v("\n            "+e._s(e.$t("login.otp.take_1m_tip"))+"\n          ")])])]),e._v(" "),t("div",{staticClass:"normal-text",staticStyle:{"margin-top":"20px","text-align":"justify"}},[e._v("\n        "+e._s(e.$t("login.otp.tfa_why"))+"\n      ")]),e._v(" "),t("div",{staticClass:"normal-text",staticStyle:{"margin-top":"20px","text-align":"justify"}},[t("p",[t("b",[e._v("\n            "+e._s(e.$t("login.otp.tfa_what_forms"))+"\n          ")])]),e._v(" "),t("div",{domProps:{innerHTML:e._s(e.$t("login.otp.tfa_what"))}})]),e._v(" "),t("div",{staticStyle:{"margin-top":"28px",display:"flex","justify-content":"center"}},[t("el-button",{staticStyle:{padding:"12px 40px"},attrs:{type:"primary"},on:{click:e.handleEnable2FA}},[e._v("\n          "+e._s(e.$t("login.otp.enable_2fa_now"))+"\n        ")])],1)])]):e._e(),e._v(" "),e.step>-1?t("div",{staticStyle:{display:"flex","flex-direction":"column","align-items":"center","margin-top":"14px"}},[t("p",{staticClass:"normal-text",staticStyle:{"font-size":"28px","line-height":"150%",color:"#656d76"}},[e._v(e._s(e.$t("login.otp.enable_2fa"))+"\n    ")]),e._v(" "),t("el-steps",{staticStyle:{width:"300px","margin-top":"28px"},attrs:{"align-center":"",active:e.step}},[t("el-step"),e._v(" "),t("el-step"),e._v(" "),t("el-step")],1)],1):e._e(),e._v(" "),e.step>-1?t("div",{staticStyle:{"max-width":"680px","margin-top":"28px","font-size":"14px","line-height":"150%",padding:"20px 20px 0px",border:"solid 1px #DADEE1","background-color":"#F7F8FA","border-radius":"6px"}},[0===e.step?t("div",{staticStyle:{color:"#1f2328","word-break":"break-word"}},[t("el-form",{ref:"form",attrs:{"label-position":"right","label-width":"100px",model:e.form,size:"small",rules:e.rules},nativeOn:{submit:function(t){return t.preventDefault(),e.sendEmailCode.apply(null,arguments)}}},[t("div",{staticClass:"mb-3 break-words",staticStyle:{"word-break":"break-word"}},[e._v("\n          "+e._s(e.$t("login.otp.open_otp_tip"))+"\n        ")]),e._v(" "),t("el-form-item",{attrs:{label:e.$t("login.account_email_placeholder"),prop:"username"}},[t("el-input",{attrs:{placeholder:e.$t("login.account_email_placeholder")},model:{value:e.form.username,callback:function(t){e.$set(e.form,"username",t)},expression:"form.username"}})],1),e._v(" "),t("el-form-item",{attrs:{label:e.$t("login.password"),prop:"password"}},[t("el-input",{attrs:{type:"password",placeholder:e.$t("login.password")},model:{value:e.form.password,callback:function(t){e.$set(e.form,"password",t)},expression:"form.password"}})],1),e._v(" "),t("el-form-item",{attrs:{label:e.$t("login.captcha"),prop:"captcha"}},[t("div",{staticStyle:{display:"flex"}},[t("el-input",{staticStyle:{"margin-right":"8px"},attrs:{placeholder:e.$t("login.captcha")},model:{value:e.form.captcha,callback:function(t){e.$set(e.form,"captcha",t)},expression:"form.captcha"}}),e._v(" "),t("img",{ref:"img",staticStyle:{height:"32px",cursor:"pointer"},attrs:{alt:""},on:{click:e.getCaptcha}})],1)]),e._v(" "),t("el-form-item",[t("el-button",{staticClass:"w-full",attrs:{"native-type":"submit",type:"primary",loading:e.loading}},[e._v(e._s(e.$t("login.send")))]),e._v(" "),e.errorMessage?t("div",{staticClass:"text-center error-message"},[e._v(e._s(e.errorMessage))]):e._e()],1)],1)],1):e._e(),e._v(" "),1===e.step?t("div",{staticStyle:{"max-width":"475px",color:"#1f2328","word-break":"break-word"}},[t("el-form",{ref:"emailForm",attrs:{size:"small",model:e.emailForm,rules:e.emailRules},nativeOn:{submit:function(e){e.preventDefault()}}},[t("div",{staticClass:"mb-2 break-words",staticStyle:{"word-break":"break-word"}},[e._v("\n          "+e._s(e.$t("login.email_code_tip"))+"\n        ")]),e._v(" "),t("el-form-item",{staticStyle:{"margin-bottom":"24px"},attrs:{prop:"emailToken"}},[t("el-input",{attrs:{placeholder:e.$t("login.verification_code")},on:{input:e.emailCodeHandleInput,blur:function(){return e.emailForm.emailToken=e.emailForm.emailToken.trim()}},model:{value:e.emailForm.emailToken,callback:function(t){e.$set(e.emailForm,"emailToken","string"==typeof t?t.trim():t)},expression:"emailForm.emailToken"}})],1),e._v(" "),t("el-form-item",[t("el-button",{key:"resetotp",staticClass:"w-full",attrs:{type:"primary",disabled:e.validateEmailCode,loading:e.loading},on:{click:e.handleGetKey}},[e._v(e._s(e.$t("common.confirm")))]),e._v(" "),e.errorMessage?t("div",{staticClass:"text-center error-message"},[e._v(e._s(e.errorMessage))]):e._e()],1)],1)],1):e._e(),e._v(" "),2===e.step?t("div",{staticStyle:{color:"#1f2328","word-break":"break-word","margin-bottom":"18px"}},[t("div",{staticClass:"sub-title",staticStyle:{"font-size":"20px"}},[e._v("\n        "+e._s(e.$t("login.otp.setup_authenticator_app")))]),e._v(" "),t("div",{staticClass:"sub-txt",domProps:{innerHTML:e._s(e.$t("login.otp.app_intro"))}}),e._v(" "),t("div",{staticClass:"sub-title"},[e._v("\n        "+e._s(e.$t("login.otp.scan_qrcode")))]),e._v(" "),t("div",{staticClass:"sub-txt"},[e._v("\n        "+e._s(e.$t("login.otp.scan_qrcode_tip")))]),e._v(" "),t("div",{staticStyle:{display:"flex","margin-top":"16px","justify-content":"center","align-items":"center"}},[t("div",{staticStyle:{position:"relative",padding:"16px","border-radius":"8px",border:"solid 2px #f6f6f6"}},[t("qrcode-vue",{attrs:{value:e.qrcodeValue,size:150,level:"H"}})],1),e._v(" "),t("div",[t("i",{staticClass:"el-icon-d-arrow-right",staticStyle:{color:"#409EFF","font-size":"32px",padding:"16px"}})]),e._v(" "),t("img",{attrs:{src:r(693),width:"150"}}),e._v(" "),t("div")]),e._v(" "),t("div",{staticClass:"sub-txt"},[e._v("\n        "+e._s(e.$t("login.otp.unalbe_scan_qrcode"))+"\n        "),t("el-button",{attrs:{type:"text"},on:{click:e.showSecretKey}},[e._v(" "+e._s(e.$t("login.otp.manual")))])],1),e._v(" "),t("div",{staticClass:"sub-title",staticStyle:{"margin-bottom":"8px"}},[e._v("\n        "+e._s(e.$t("login.otp.verify_code"))+"\n      ")]),e._v(" "),t("div",{staticStyle:{display:"flex"}},[t("el-input",{attrs:{placeholder:"xxxxxx",disabled:e.inputDisabled},on:{input:e.OTPCodeHandleInput},model:{value:e.OTPCode,callback:function(t){e.OTPCode=t},expression:"OTPCode"}})],1),e._v(" "),e.errorMessage?t("div",{staticClass:"text-center error-message mt-1",staticStyle:{color:"#F56C6C"}},[e._v(e._s(e.errorMessage))]):e._e()]):e._e()]):e._e()])}),[],!1,null,"10a92a2b",null);t.default=component.exports}}]);